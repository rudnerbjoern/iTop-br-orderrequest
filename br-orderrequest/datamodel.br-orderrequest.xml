<?xml version="1.0" encoding="UTF-8"?>
<itop_design version="3.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://rudnerbjoern.github.io/iTop-schema/3.2/itop_design.xsd">
    <!--
    * @copyright   Copyright (C) 2025 BjÃ¶rn Rudner
    * @license     https://www.gnu.org/licenses/gpl-3.0.en.html
    -->
    <classes>
        <class id="OrderRequest" _delta="define">
            <parent>Ticket</parent>
            <php_parent>
                <name>BR\Extension\OrderRequest\Model\_OrderRequest</name>
                <file>src/Model/_OrderRequest.php</file>
            </php_parent>
            <properties>
                <category>bizmodel,searchable,requestmgmt</category>
                <abstract>false</abstract>
                <key_type>autoincrement</key_type>
                <db_table>orderrequest</db_table>
                <db_key_field>id</db_key_field>
                <db_final_class_field />
                <naming>
                    <attributes>
                        <attribute id="ref" />
                    </attributes>
                    <complementary_attributes>
                        <attribute id="title" />
                    </complementary_attributes>
                </naming>
                <style>
                    <icon>images/orderrequest.svg</icon>
                    <main_color>#0D9488</main_color>
                </style>
                <reconciliation>
                    <attributes>
                        <attribute id="ref" />
                        <attribute id="title" />
                        <attribute id="org_id" />
                        <attribute id="org_name" />
                    </attributes>
                </reconciliation>
                <fields_semantic>
                    <state_attribute>status</state_attribute>
                </fields_semantic>
                <order>
                    <columns>
                        <column id="ref" ascending="false" />
                    </columns>
                </order>
            </properties>
            <fields>
                <field id="status" xsi:type="AttributeEnum">
                    <sql>status</sql>
                    <values>
                        <value id="draft">
                            <code>draft</code>
                            <rank>10</rank>
                            <style>
                                <main_color>$ibo-lifecycle-new-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-new-state-secondary-color</complementary_color>
                                <decoration_classes>fas fa-plus-circle</decoration_classes>
                            </style>
                        </value>
                        <value id="submitted">
                            <code>submitted</code>
                            <rank>20</rank>
                            <style>
                                <main_color>$ibo-lifecycle-active-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-active-state-secondary-color</complementary_color>
                                <decoration_classes>fas fa-paper-plane</decoration_classes>
                            </style>
                        </value>
                        <value id="in_review">
                            <code>in_review</code>
                            <rank>30</rank>
                            <style>
                                <main_color>$ibo-lifecycle-active-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-active-state-secondary-color</complementary_color>
                                <decoration_classes>fas fa-search-plus</decoration_classes>
                            </style>
                        </value>
                        <value id="waiting_approval">
                            <code>waiting_approval</code>
                            <rank>40</rank>
                            <style>
                                <main_color>$ibo-lifecycle-waiting-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-waiting-state-secondary-color</complementary_color>
                                <decoration_classes>fas fa-hourglass-half</decoration_classes>
                            </style>
                        </value>
                        <value id="waiting_budget_approval">
                            <code>waiting_budget_approval</code>
                            <rank>50</rank>
                            <style>
                                <main_color>$ibo-lifecycle-waiting-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-waiting-state-secondary-color</complementary_color>
                                <decoration_classes>fas fa-coins</decoration_classes>
                            </style>
                        </value>
                        <value id="approved">
                            <code>approved</code>
                            <rank>60</rank>
                            <style>
                                <main_color>$ibo-lifecycle-success-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-success-state-secondary-color</complementary_color>
                                <decoration_classes>fas fa-check-circle</decoration_classes>
                            </style>
                        </value>
                        <value id="procurement">
                            <code>procurement</code>
                            <rank>70</rank>
                            <style>
                                <main_color>$ibo-lifecycle-neutral-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-neutral-state-secondary-color</complementary_color>
                                <decoration_classes>fas fa-shopping-cart</decoration_classes>
                            </style>
                        </value>
                        <value id="rejected">
                            <code>rejected</code>
                            <rank>80</rank>
                            <style>
                                <main_color>$ibo-lifecycle-failure-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-failure-state-secondary-color</complementary_color>
                                <decoration_classes>fas fa-times-circle</decoration_classes>
                            </style>
                        </value>
                        <value id="closed">
                            <code>closed</code>
                            <rank>90</rank>
                            <style>
                                <main_color>$ibo-lifecycle-frozen-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-frozen-state-secondary-color</complementary_color>
                                <decoration_classes>fas fa-flag-checkered</decoration_classes>
                            </style>
                        </value>
                    </values>
                    <display_style>list</display_style>
                    <sort_type>rank</sort_type>
                    <default_value>draft</default_value>
                    <is_null_allowed>false</is_null_allowed>
                </field>
                <field id="request_type_id" xsi:type="AttributeExternalKey">
                    <sql>request_type_id</sql>
                    <target_class>OrderRequestType</target_class>
                    <filter><![CDATA[SELECT OrderRequestType WHERE status = 'active' AND org_id = :this->org_id]]></filter>
                    <dependencies>
                        <attribute id="org_id" />
                    </dependencies>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="request_type_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>request_type_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <field id="technical_approver_id" xsi:type="AttributeExternalKey">
                    <sql>technical_approver_id</sql>
                    <target_class>Person</target_class>
                    <filter>
                        <![CDATA[SELECT Person AS P JOIN Organization AS Node ON P.org_id = Node.id JOIN Organization AS Root ON Node.parent_id BELOW Root.id WHERE Root.id = :this->org_id]]>
                    </filter>
                    <dependencies>
                        <attribute id="org_id" />
                        <attribute id="request_type_id" />
                    </dependencies>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="technical_approver_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>technical_approver_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <field id="budget_approver_id" xsi:type="AttributeExternalKey">
                    <sql>budget_approver_id</sql>
                    <target_class>Person</target_class>
                    <filter>
                        <![CDATA[SELECT Person AS P JOIN Organization AS Node ON P.org_id = Node.id JOIN Organization AS Root ON Node.parent_id BELOW Root.id WHERE Root.id = :this->org_id]]>
                    </filter>
                    <dependencies>
                        <attribute id="org_id" />
                        <attribute id="request_type_id" />
                    </dependencies>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="budget_approver_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>budget_approver_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <field id="approved_by_id" xsi:type="AttributeExternalKey">
                    <sql>approved_by_id</sql>
                    <target_class>Person</target_class>
                    <dependencies>
                        <attribute id="org_id" />
                    </dependencies>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="approved_by_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>approved_by_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <field id="approval_comment" xsi:type="AttributeHTML">
                    <sql>approval_comment</sql>
                    <default_value />
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="budget_approved_by_id" xsi:type="AttributeExternalKey">
                    <sql>budget_approved_by_id</sql>
                    <target_class>Person</target_class>
                    <dependencies>
                        <attribute id="org_id" />
                    </dependencies>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="budget_approved_by_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>budget_approved_by_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <field id="budget_approval_comment" xsi:type="AttributeHTML">
                    <sql>budget_approval_comment</sql>
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="approval_request_date" xsi:type="AttributeDateTime">
                    <sql>approval_request_date</sql>
                    <default_value />
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="approval_date" xsi:type="AttributeDateTime">
                    <sql>approval_date</sql>
                    <default_value />
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="budget_approval_request_date" xsi:type="AttributeDateTime">
                    <sql>budget_approval_request_date</sql>
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="budget_approval_date" xsi:type="AttributeDateTime">
                    <sql>budget_approval_date</sql>
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="procurement_reference" xsi:type="AttributeString">
                    <sql>procurement_reference</sql>
                    <default_value />
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="line_items" xsi:type="AttributeLinkedSet">
                    <linked_class>OrderRequestLineItem</linked_class>
                    <ext_key_to_me>order_request_id</ext_key_to_me>
                    <with_php_computation>true</with_php_computation>
                    <with_php_constraint>true</with_php_constraint>
                </field>
                <field id="estimated_total_cost" xsi:type="AttributeDecimal">
                    <sql>estimated_total_cost</sql>
                    <default_value>0.00</default_value>
                    <is_null_allowed>false</is_null_allowed>
                    <digits>12</digits>
                    <decimals>2</decimals>
                </field>
                <field id="parent_request_id" xsi:type="AttributeExternalKey">
                    <sql>parent_request_id</sql>
                    <target_class>UserRequest</target_class>
                    <filter><![CDATA[SELECT UserRequest WHERE status NOT IN ('rejected','resolved','closed')]]></filter>
                    <dependencies />
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="parent_request_ref" xsi:type="AttributeExternalField">
                    <extkey_attcode>parent_request_id</extkey_attcode>
                    <target_attcode>ref</target_attcode>
                </field>
                <field id="parent_incident_id" xsi:type="AttributeExternalKey">
                    <sql>parent_incident_id</sql>
                    <target_class>Incident</target_class>
                    <filter><![CDATA[SELECT Incident WHERE status != 'closed']]></filter>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="parent_incident_ref" xsi:type="AttributeExternalField">
                    <extkey_attcode>parent_incident_id</extkey_attcode>
                    <target_attcode>ref</target_attcode>
                </field>
                <field id="parent_problem_id" xsi:type="AttributeExternalKey">
                    <sql>parent_problem_id</sql>
                    <target_class>Problem</target_class>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="parent_problem_ref" xsi:type="AttributeExternalField">
                    <extkey_attcode>parent_problem_id</extkey_attcode>
                    <target_attcode>ref</target_attcode>
                </field>
                <field id="parent_change_id" xsi:type="AttributeExternalKey">
                    <sql>parent_change_id</sql>
                    <target_class>Change</target_class>
                    <filter><![CDATA[SELECT Change WHERE status != 'closed']]></filter>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="parent_change_ref" xsi:type="AttributeExternalField">
                    <extkey_attcode>parent_change_id</extkey_attcode>
                    <target_attcode>ref</target_attcode>
                </field>
                <field id="related_request_list" xsi:type="AttributeLinkedSet">
                    <linked_class>UserRequest</linked_class>
                    <ext_key_to_me>parent_request_id</ext_key_to_me>
                    <edit_mode>add_remove</edit_mode>
                    <count_min>0</count_min>
                    <count_max>0</count_max>
                </field>
            </fields>
            <lifecycle>
                <stimuli>
                    <stimulus id="ev_submit" xsi:type="StimulusUserAction" />
                    <stimulus id="ev_review" xsi:type="StimulusUserAction" />
                    <stimulus id="ev_request_approval" xsi:type="StimulusUserAction" />
                    <stimulus id="ev_approve" xsi:type="StimulusUserAction" />
                    <stimulus id="ev_reject" xsi:type="StimulusUserAction" />
                    <stimulus id="ev_request_budget_approval" xsi:type="StimulusUserAction" />
                    <stimulus id="ev_budget_approve" xsi:type="StimulusUserAction" />
                    <stimulus id="ev_budget_reject" xsi:type="StimulusUserAction" />
                    <stimulus id="ev_procure" xsi:type="StimulusUserAction" />
                    <stimulus id="ev_close" xsi:type="StimulusUserAction" />
                </stimuli>
                <states>
                    <state id="draft">
                        <flags>
                            <attribute id="start_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_request_date">
                                <hidden />
                            </attribute>
                            <attribute id="approval_date">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approval_request_date">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approval_date">
                                <hidden />
                            </attribute>
                            <attribute id="close_date">
                                <hidden />
                            </attribute>
                            <attribute id="end_date">
                                <hidden />
                            </attribute>
                            <attribute id="last_update">
                                <read_only />
                            </attribute>

                            <attribute id="estimated_total_cost">
                                <read_only />
                            </attribute>
                            <attribute id="approved_by_id">
                                <hidden />
                            </attribute>
                            <attribute id="approval_comment">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approved_by_id">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approval_comment">
                                <hidden />
                            </attribute>
                        </flags>
                        <transitions>
                            <transition id="ev_submit">
                                <target>submitted</target>
                                <flags />
                                <actions />
                            </transition>
                            <transition id="ev_reject">
                                <target>rejected</target>
                                <flags />
                                <actions>
                                    <action id="set-close-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">close_date</param>
                                        </params>
                                    </action>
                                    <action id="set-end-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">end_date</param>
                                        </params>
                                    </action>
                                </actions>
                            </transition>
                        </transitions>
                    </state>
                    <state id="submitted">
                        <inherit_flags_from>draft</inherit_flags_from>
                        <flags>
                            <attribute id="start_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_request_date">
                                <hidden />
                            </attribute>
                            <attribute id="approval_date">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approval_request_date">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approval_date">
                                <hidden />
                            </attribute>
                            <attribute id="close_date">
                                <hidden />
                            </attribute>
                            <attribute id="end_date">
                                <hidden />
                            </attribute>
                            <attribute id="last_update">
                                <read_only />
                            </attribute>

                            <attribute id="parent_request_id">
                                <read_only />
                            </attribute>
                            <attribute id="parent_incident_id">
                                <read_only />
                            </attribute>
                            <attribute id="parent_problem_id">
                                <read_only />
                            </attribute>
                            <attribute id="parent_change_id">
                                <read_only />
                            </attribute>
                            <attribute id="related_request_list">
                                <read_only />
                            </attribute>

                            <attribute id="title">
                                <read_only />
                                <mandatory />
                            </attribute>
                            <attribute id="org_id">
                                <read_only />
                                <mandatory />
                            </attribute>
                            <attribute id="caller_id">
                                <read_only />
                                <mandatory />
                            </attribute>
                            <attribute id="request_type_id">
                                <read_only />
                                <mandatory />
                            </attribute>
                            <attribute id="description">
                                <read_only />
                                <mandatory />
                            </attribute>
                            <attribute id="technical_approver_id">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approver_id">
                                <read_only />
                            </attribute>
                            <attribute id="line_items">
                                <read_only />
                            </attribute>
                        </flags>
                        <transitions>
                            <transition id="ev_review">
                                <target>in_review</target>
                                <flags />
                                <actions />
                            </transition>
                        </transitions>
                    </state>
                    <state id="in_review">
                        <inherit_flags_from>submitted</inherit_flags_from>
                        <flags>
                            <attribute id="start_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_request_date">
                                <hidden />
                            </attribute>
                            <attribute id="approval_date">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approval_request_date">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approval_date">
                                <hidden />
                            </attribute>
                            <attribute id="close_date">
                                <hidden />
                            </attribute>
                            <attribute id="end_date">
                                <hidden />
                            </attribute>
                            <attribute id="last_update">
                                <read_only />
                            </attribute>
                        </flags>
                        <transitions>
                            <transition id="ev_request_approval">
                                <target>waiting_approval</target>
                                <flags />
                                <actions>
                                    <action id="set-approval-req-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">approval_request_date</param>
                                        </params>
                                    </action>
                                </actions>
                            </transition>
                        </transitions>
                    </state>
                    <state id="waiting_approval">
                        <inherit_flags_from>in_review</inherit_flags_from>
                        <flags>
                            <attribute id="start_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_date">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approval_request_date">
                                <hidden />
                            </attribute>
                            <attribute id="budget_approval_date">
                                <hidden />
                            </attribute>
                            <attribute id="close_date">
                                <hidden />
                            </attribute>
                            <attribute id="end_date">
                                <hidden />
                            </attribute>
                            <attribute id="last_update">
                                <read_only />
                            </attribute>

                            <attribute id="approved_by_id">
                                <hidden />
                            </attribute>
                            <attribute id="approval_comment" />
                        </flags>
                        <transitions>
                            <transition id="ev_approve">
                                <target>approved</target>
                                <flags>
                                    <attribute id="approval_comment">
                                        <mandatory />
                                        <must_prompt />
                                    </attribute>
                                </flags>
                                <actions>
                                    <action id="set-approver">
                                        <verb>SetCurrentPerson</verb>
                                        <params>
                                            <param xsi:type="string">approved_by_id</param>
                                        </params>
                                    </action>
                                    <action id="set-approval-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">approval_date</param>
                                        </params>
                                    </action>
                                </actions>
                            </transition>
                            <transition id="ev_request_budget_approval">
                                <target>waiting_budget_approval</target>
                                <flags>
                                    <attribute id="approval_comment">
                                        <mandatory />
                                        <must_prompt />
                                    </attribute>
                                    <attribute id="budget_approver_id">
                                        <mandatory />
                                    </attribute>
                                </flags>
                                <actions>
                                    <action id="set-approver">
                                        <verb>SetCurrentPerson</verb>
                                        <params>
                                            <param xsi:type="string">approved_by_id</param>
                                        </params>
                                    </action>
                                    <action id="set-approval-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">approval_date</param>
                                        </params>
                                    </action>
                                    <action id="set-budget-approval-req-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">budget_approval_request_date</param>
                                        </params>
                                    </action>
                                </actions>
                            </transition>
                            <transition id="ev_reject">
                                <target>rejected</target>
                                <flags />
                                <actions>
                                    <action id="set-reject-by">
                                        <verb>SetCurrentPerson</verb>
                                        <params>
                                            <param xsi:type="string">approved_by_id</param>
                                        </params>
                                    </action>
                                    <action id="set-reject-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">approval_date</param>
                                        </params>
                                    </action>
                                    <action id="set-close-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">close_date</param>
                                        </params>
                                    </action>
                                    <action id="set-end-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">end_date</param>
                                        </params>
                                    </action>
                                </actions>
                            </transition>
                        </transitions>
                    </state>
                    <state id="waiting_budget_approval">
                        <inherit_flags_from>waiting_approval</inherit_flags_from>
                        <flags>
                            <attribute id="start_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_date">
                                <hidden />
                            </attribute>
                            <attribute id="close_date">
                                <hidden />
                            </attribute>
                            <attribute id="end_date">
                                <hidden />
                            </attribute>
                            <attribute id="last_update">
                                <read_only />
                            </attribute>

                            <attribute id="approved_by_id">
                                <read_only />
                            </attribute>
                            <attribute id="approval_comment">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_comment" />
                        </flags>
                        <transitions>
                            <transition id="ev_budget_approve">
                                <target>approved</target>
                                <flags>
                                    <attribute id="budget_approval_comment">
                                        <mandatory />
                                        <must_prompt />
                                    </attribute>
                                </flags>
                                <actions>
                                    <action id="set-budget-approver-user">
                                        <verb>SetCurrentPerson</verb>
                                        <params>
                                            <param xsi:type="string">budget_approved_by_id</param>
                                        </params>
                                    </action>
                                    <action id="set-budget-approval-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">budget_approval_date</param>
                                        </params>
                                    </action>
                                </actions>
                            </transition>
                            <transition id="ev_budget_reject">
                                <target>rejected</target>
                                <flags>
                                    <attribute id="budget_approval_comment">
                                        <mandatory />
                                        <must_prompt />
                                    </attribute>
                                </flags>
                                <actions>
                                    <action id="set-budget-reject-user">
                                        <verb>SetCurrentPerson</verb>
                                        <params>
                                            <param xsi:type="string">budget_approved_by_id</param>
                                        </params>
                                    </action>
                                    <action id="set-budget-reject-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">budget_approval_date</param>
                                        </params>
                                    </action>
                                    <action id="set-close-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">close_date</param>
                                        </params>
                                    </action>
                                    <action id="set-end-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">end_date</param>
                                        </params>
                                    </action>
                                </actions>
                            </transition>
                        </transitions>
                    </state>
                    <state id="approved">
                        <inherit_flags_from>waiting_approval</inherit_flags_from>
                        <flags>
                            <attribute id="start_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_date">
                                <read_only />
                            </attribute>
                            <attribute id="close_date">
                                <hidden />
                            </attribute>
                            <attribute id="end_date">
                                <hidden />
                            </attribute>
                            <attribute id="last_update">
                                <read_only />
                            </attribute>

                            <attribute id="approved_by_id">
                                <read_only />
                            </attribute>
                            <attribute id="approval_comment">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approved_by_id">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_comment">
                                <read_only />
                            </attribute>
                        </flags>
                        <transitions>
                            <transition id="ev_procure">
                                <target>procurement</target>
                                <flags>
                                    <attribute id="procurement_reference">
                                        <mandatory />
                                        <must_prompt />
                                    </attribute>
                                </flags>
                                <actions />
                            </transition>
                        </transitions>
                    </state>
                    <state id="procurement">
                        <inherit_flags_from>approved</inherit_flags_from>
                        <flags>
                            <attribute id="start_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_date">
                                <read_only />
                            </attribute>
                            <attribute id="close_date">
                                <hidden />
                            </attribute>
                            <attribute id="end_date">
                                <hidden />
                            </attribute>
                            <attribute id="last_update">
                                <read_only />
                            </attribute>
                            <attribute id="procurement_reference">
                                <read_only />
                            </attribute>
                        </flags>
                        <transitions>
                            <transition id="ev_close">
                                <target>closed</target>
                                <flags />
                                <actions>
                                    <action id="set-close-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">close_date</param>
                                        </params>
                                    </action>
                                    <action id="set-end-date">
                                        <verb>SetCurrentDate</verb>
                                        <params>
                                            <param xsi:type="string">end_date</param>
                                        </params>
                                    </action>
                                </actions>
                            </transition>
                        </transitions>
                    </state>
                    <state id="rejected">
                        <flags>
                            <attribute id="start_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_date">
                                <read_only />
                            </attribute>
                            <attribute id="close_date">
                                <read_only />
                            </attribute>
                            <attribute id="end_date">
                                <read_only />
                            </attribute>
                            <attribute id="last_update">
                                <read_only />
                            </attribute>

                            <attribute id="approval_comment">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_comment">
                                <read_only />
                            </attribute>
                        </flags>
                        <transitions />
                    </state>
                    <state id="closed">
                        <inherit_flags_from>procurement</inherit_flags_from>
                        <flags>
                            <attribute id="start_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="approval_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_request_date">
                                <read_only />
                            </attribute>
                            <attribute id="budget_approval_date">
                                <read_only />
                            </attribute>
                            <attribute id="close_date">
                                <read_only />
                            </attribute>
                            <attribute id="end_date">
                                <read_only />
                            </attribute>
                            <attribute id="last_update">
                                <read_only />
                            </attribute>
                        </flags>
                        <transitions />
                    </state>
                </states>
            </lifecycle>
            <event_listeners>
                <event_listener id="OnOrderRequestSetInitialAttributesFlags">
                    <event>EVENT_DB_SET_INITIAL_ATTRIBUTES_FLAGS</event>
                    <callback>OnOrderRequestSetInitialAttributesFlags</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnOrderRequestSetAttributesFlags">
                    <event>EVENT_DB_SET_ATTRIBUTES_FLAGS</event>
                    <callback>OnOrderRequestSetAttributesFlags</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnOrderRequestEnumTransitions">
                    <event>EVENT_ENUM_TRANSITIONS</event>
                    <callback>OnOrderRequestEnumTransitions</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnOrderRequestLinksChanged">
                    <event>EVENT_DB_LINKS_CHANGED</event>
                    <callback>OnOrderRequestLinksChanged</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnOrderRequestComputeValues">
                    <event>EVENT_DB_COMPUTE_VALUES</event>
                    <callback>OnOrderRequestComputeValues</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnOrderRequestCheckToWrite">
                    <event>EVENT_DB_CHECK_TO_WRITE</event>
                    <callback>OnOrderRequestCheckToWrite</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnOrderRequestBeforeWrite">
                    <event>EVENT_DB_BEFORE_WRITE</event>
                    <callback>OnOrderRequestBeforeWrite</callback>
                    <rank>10</rank>
                </event_listener>
            </event_listeners>
            <methods />
            <presentation>
                <details>
                    <items>
                        <item id="col:col0">
                            <rank>10</rank>
                            <items>
                                <item id="fieldset:Ticket:baseinfo">
                                    <rank>10</rank>
                                    <items>
                                        <item id="org_id">
                                            <rank>10</rank>
                                        </item>
                                        <item id="title">
                                            <rank>20</rank>
                                        </item>
                                        <item id="status">
                                            <rank>30</rank>
                                        </item>
                                        <item id="request_type_id">
                                            <rank>40</rank>
                                        </item>
                                        <item id="caller_id">
                                            <rank>50</rank>
                                        </item>
                                        <item id="description">
                                            <rank>60</rank>
                                        </item>
                                    </items>
                                </item>
                            </items>
                        </item>
                        <item id="col:col1">
                            <rank>20</rank>
                            <items>
                                <item id="fieldset:OrderRequest:costs">
                                    <rank>10</rank>
                                    <items>
                                        <item id="estimated_total_cost">
                                            <rank>10</rank>
                                        </item>
                                        <item id="procurement_reference">
                                            <rank>20</rank>
                                        </item>
                                    </items>
                                </item>
                                <item id="fieldset:OrderRequest:approval">
                                    <rank>20</rank>
                                    <items>
                                        <item id="technical_approver_id">
                                            <rank>10</rank>
                                        </item>
                                        <item id="approved_by_id">
                                            <rank>20</rank>
                                        </item>
                                        <item id="approval_comment">
                                            <rank>30</rank>
                                        </item>
                                        <item id="budget_approver_id">
                                            <rank>40</rank>
                                        </item>
                                        <item id="budget_approved_by_id">
                                            <rank>50</rank>
                                        </item>
                                        <item id="budget_approval_comment">
                                            <rank>60</rank>
                                        </item>
                                    </items>
                                </item>
                            </items>
                        </item>
                        <item id="col:col2">
                            <rank>30</rank>
                            <items>
                                <item id="fieldset:Ticket:relation">
                                    <rank>10</rank>
                                    <items>
                                        <item id="parent_request_id">
                                            <rank>10</rank>
                                        </item>
                                        <item id="parent_incident_id">
                                            <rank>20</rank>
                                        </item>
                                        <item id="parent_problem_id">
                                            <rank>30</rank>
                                        </item>
                                        <item id="parent_change_id">
                                            <rank>40</rank>
                                        </item>
                                    </items>
                                </item>
                                <item id="fieldset:Ticket:date">
                                    <rank>30</rank>
                                    <items>
                                        <item id="start_date">
                                            <rank>10</rank>
                                        </item>
                                        <item id="approval_request_date">
                                            <rank>20</rank>
                                        </item>
                                        <item id="approval_date">
                                            <rank>30</rank>
                                        </item>
                                        <item id="budget_approval_request_date">
                                            <rank>40</rank>
                                        </item>
                                        <item id="budget_approval_date">
                                            <rank>50</rank>
                                        </item>
                                        <item id="close_date">
                                            <rank>60</rank>
                                        </item>
                                        <item id="last_update">
                                            <rank>70</rank>
                                        </item>
                                    </items>
                                </item>
                            </items>
                        </item>
                        <item id="line_items">
                            <rank>100</rank>
                        </item>
                        <item id="functionalcis_list">
                            <rank>110</rank>
                        </item>
                        <item id="contacts_list">
                            <rank>120</rank>
                        </item>
                        <item id="related_request_list">
                            <rank>130</rank>
                        </item>
                        <item id="private_log">
                            <rank>200</rank>
                        </item>
                    </items>
                </details>
                <search>
                    <items>
                        <item id="ref">
                            <rank>10</rank>
                        </item>
                        <item id="title">
                            <rank>20</rank>
                        </item>
                        <item id="org_id">
                            <rank>30</rank>
                        </item>
                        <item id="caller_id">
                            <rank>40</rank>
                        </item>
                        <item id="request_type_name" _delta="define">
                            <rank>50</rank>
                        </item>
                        <item id="status">
                            <rank>60</rank>
                        </item>
                        <item id="technical_approver_id">
                            <rank>70</rank>
                        </item>
                        <item id="approved_by_id">
                            <rank>80</rank>
                        </item>
                        <item id="approval_date">
                            <rank>90</rank>
                        </item>
                        <item id="procurement_reference">
                            <rank>100</rank>
                        </item>
                        <item id="estimated_total_cost">
                            <rank>110</rank>
                        </item>
                        <item id="start_date">
                            <rank>120</rank>
                        </item>
                        <item id="close_date">
                            <rank>130</rank>
                        </item>
                        <item id="agent_id">
                            <rank>140</rank>
                        </item>
                        <item id="team_id">
                            <rank>150</rank>
                        </item>
                    </items>
                </search>
                <list>
                    <items>
                        <item id="title">
                            <rank>20</rank>
                        </item>
                        <item id="request_type_name">
                            <rank>30</rank>
                        </item>
                        <item id="org_id">
                            <rank>40</rank>
                        </item>
                        <item id="caller_id">
                            <rank>50</rank>
                        </item>
                        <item id="status">
                            <rank>60</rank>
                        </item>
                        <item id="technical_approver_id">
                            <rank>70</rank>
                        </item>
                        <item id="estimated_total_cost">
                            <rank>80</rank>
                        </item>
                        <item id="approval_date">
                            <rank>90</rank>
                        </item>
                        <item id="agent_id">
                            <rank>100</rank>
                        </item>
                    </items>
                </list>
                <summary>
                    <items>
                        <item id="title">
                            <rank>20</rank>
                        </item>
                        <item id="request_type_name">
                            <rank>30</rank>
                        </item>
                        <item id="estimated_total_cost">
                            <rank>50</rank>
                        </item>
                    </items>
                </summary>
            </presentation>
        </class>
        <class id="OrderRequestLineItem" _delta="define">
            <parent>cmdbAbstractObject</parent>
            <php_parent>
                <name>BR\Extension\OrderRequest\Model\_OrderRequestLineItem</name>
                <file>src/Model/_OrderRequestLineItem.php</file>
            </php_parent>
            <properties>
                <category>bizmodel,searchable,application</category>
                <abstract>false</abstract>
                <key_type>autoincrement</key_type>
                <db_table>orderrequestlineitem</db_table>
                <db_key_field>id</db_key_field>
                <db_final_class_field />
                <naming>
                    <attributes>
                        <attribute id="order_request_ref" />
                        <attribute id="line_number" />
                    </attributes>
                    <complementary_attributes>
                        <attribute id="name" />
                    </complementary_attributes>
                </naming>
                <style>
                    <icon>images/orderrequestlineitem.svg</icon>
                    <main_color>#5FD6CB</main_color>
                </style>
                <order>
                    <columns>
                        <column id="line_number" ascending="true" />
                    </columns>
                </order>
                <uniqueness_rules>
                    <rule id="unique_per_order_and_line">
                        <attributes>
                            <attribute id="order_request_id" />
                            <attribute id="line_number" />
                        </attributes>
                    </rule>
                </uniqueness_rules>
            </properties>
            <fields>
                <field id="order_request_id" xsi:type="AttributeExternalKey">
                    <sql>order_request_id</sql>
                    <is_null_allowed>false</is_null_allowed>
                    <target_class>OrderRequest</target_class>
                    <on_target_delete>DEL_AUTO</on_target_delete>
                </field>
                <field id="order_request_ref" xsi:type="AttributeExternalField">
                    <extkey_attcode>order_request_id</extkey_attcode>
                    <target_attcode>ref</target_attcode>
                </field>
                <field id="line_number" xsi:type="AttributeInteger">
                    <sql>line_number</sql>
                    <default_value />
                    <is_null_allowed>false</is_null_allowed>
                </field>
                <field id="name" xsi:type="AttributeString">
                    <sql>name</sql>
                    <is_null_allowed>false</is_null_allowed>
                    <default_value />
                </field>
                <field id="vendor_sku" xsi:type="AttributeString">
                    <sql>vendor_sku</sql>
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="description" xsi:type="AttributeHTML">
                    <sql>description</sql>
                    <default_value />
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="quantity" xsi:type="AttributeInteger">
                    <sql>quantity</sql>
                    <default_value>1</default_value>
                    <is_null_allowed>false</is_null_allowed>
                </field>
                <field id="uom" xsi:type="AttributeEnum">
                    <sql>uom</sql>
                    <values _delta="redefine">
                        <value id="EA">
                            <code>EA</code>
                            <rank>10</rank>
                        </value>
                        <value id="PT">
                            <code>PT</code>
                            <rank>20</rank>
                        </value>
                        <value id="HUR">
                            <code>HUR</code>
                            <rank>30</rank>
                        </value>
                        <value id="LIC">
                            <code>LIC</code>
                            <rank>40</rank>
                        </value>
                        <value id="SET">
                            <code>SET</code>
                            <rank>50</rank>
                        </value>
                        <value id="MON">
                            <code>MON</code>
                            <rank>60</rank>
                        </value>
                        <value id="ANN">
                            <code>ANN</code>
                            <rank>70</rank>
                        </value>
                    </values>
                    <is_null_allowed>true</is_null_allowed>
                    <default_value>EA</default_value>
                    <display_style>list</display_style>
                    <sort_type>rank</sort_type>
                </field>
                <field id="unit_price_estimated" xsi:type="AttributeDecimal">
                    <sql>unit_price_estimated</sql>
                    <default_value />
                    <is_null_allowed>true</is_null_allowed>
                    <digits>12</digits>
                    <decimals>2</decimals>
                </field>
                <field id="total_price_estimated" xsi:type="AttributeDecimal">
                    <sql>total_price_estimated</sql>
                    <default_value />
                    <is_null_allowed>true</is_null_allowed>
                    <digits>12</digits>
                    <decimals>2</decimals>
                    <dependencies>
                        <attribute id="quantity" />
                        <attribute id="unit_price_estimated" />
                    </dependencies>
                </field>
                <field id="functionalcis_list" xsi:type="AttributeLinkedSet">
                    <linked_class>lnkOrderRequestLineItemToFunctionalCI</linked_class>
                    <ext_key_to_me>order_request_line_item_id</ext_key_to_me>
                    <edit_mode>add_remove</edit_mode>
                    <count_min>0</count_min>
                    <count_max>0</count_max>
                </field>
            </fields>
            <event_listeners>
                <event_listener id="OnLineItemSetInitialAttributesFlags">
                    <event>EVENT_DB_SET_INITIAL_ATTRIBUTES_FLAGS</event>
                    <callback>OnLineItemSetInitialAttributesFlags</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnLineItemSetAttributesFlags">
                    <event>EVENT_DB_SET_ATTRIBUTES_FLAGS</event>
                    <callback>OnLineItemSetAttributesFlags</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnLineItemComputeValues">
                    <event>EVENT_DB_COMPUTE_VALUES</event>
                    <callback>OnLineItemComputeValues</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnLineItemCheckToWrite">
                    <event>EVENT_DB_CHECK_TO_WRITE</event>
                    <callback>OnLineItemCheckToWrite</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnLineItemCheckToDelete">
                    <event>EVENT_DB_CHECK_TO_DELETE</event>
                    <callback>OnLineItemCheckToDelete</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnLineItemBeforeWrite">
                    <event>EVENT_DB_BEFORE_WRITE</event>
                    <callback>OnLineItemBeforeWrite</callback>
                    <rank>10</rank>
                </event_listener>
            </event_listeners>
            <methods />
            <presentation>
                <details>
                    <items>
                        <item id="col:col0">
                            <rank>10</rank>
                            <items>
                                <item id="fieldset:OrderRequestLineItem:base">
                                    <rank>10</rank>
                                    <items>
                                        <item id="order_request_id">
                                            <rank>10</rank>
                                        </item>
                                        <item id="line_number">
                                            <rank>20</rank>
                                        </item>
                                        <item id="name">
                                            <rank>30</rank>
                                        </item>
                                        <item id="vendor_sku">
                                            <rank>40</rank>
                                        </item>
                                    </items>
                                </item>
                                <item id="fieldset:OrderRequestLineItem:qtyprice">
                                    <rank>20</rank>
                                    <items>
                                        <item id="quantity">
                                            <rank>10</rank>
                                        </item>
                                        <item id="uom">
                                            <rank>20</rank>
                                        </item>
                                        <item id="unit_price_estimated">
                                            <rank>30</rank>
                                        </item>
                                        <item id="total_price_estimated">
                                            <rank>40</rank>
                                        </item>
                                    </items>
                                </item>
                            </items>
                        </item>
                        <item id="col:col1" _delta="define">
                            <rank>20</rank>
                            <items>
                                <item id="fieldset:OrderRequestLineItem:description">
                                    <rank>10</rank>
                                    <items>
                                        <item id="description">
                                            <rank>10</rank>
                                        </item>
                                    </items>
                                </item>
                            </items>
                        </item>
                        <item id="functionalcis_list">
                            <rank>100</rank>
                        </item>
                    </items>
                </details>
                <list>
                    <items>
                        <item id="name">
                            <rank>20</rank>
                        </item>
                        <item id="vendor_sku">
                            <rank>30</rank>
                        </item>
                        <item id="quantity">
                            <rank>40</rank>
                        </item>
                        <item id="uom">
                            <rank>50</rank>
                        </item>
                        <item id="unit_price_estimated">
                            <rank>60</rank>
                        </item>
                        <item id="total_price_estimated">
                            <rank>70</rank>
                        </item>
                    </items>
                </list>
                <search>
                    <items>
                        <item id="order_request_ref">
                            <rank>10</rank>
                        </item>
                        <item id="line_number">
                            <rank>20</rank>
                        </item>
                        <item id="name">
                            <rank>30</rank>
                        </item>
                        <item id="vendor_sku">
                            <rank>40</rank>
                        </item>
                        <item id="quantity">
                            <rank>50</rank>
                        </item>
                        <item id="uom">
                            <rank>60</rank>
                        </item>
                        <item id="unit_price_estimated">
                            <rank>70</rank>
                        </item>
                        <item id="total_price_estimated">
                            <rank>80</rank>
                        </item>
                    </items>
                </search>
                <summary>
                    <items>
                        <item id="name">
                            <rank>10</rank>
                        </item>
                        <item id="line_number">
                            <rank>20</rank>
                        </item>
                        <item id="quantity">
                            <rank>30</rank>
                        </item>
                        <item id="uom">
                            <rank>40</rank>
                        </item>
                        <item id="total_price_estimated">
                            <rank>50</rank>
                        </item>
                    </items>
                </summary>
            </presentation>
        </class>
        <class id="lnkOrderRequestLineItemToFunctionalCI" _delta="define">
            <parent>cmdbAbstractObject</parent>
            <properties>
                <category>bizmodel,searchable,application</category>
                <abstract>false</abstract>
                <key_type>autoincrement</key_type>
                <db_table>lnkorderrequestlineitemtofunctionalci</db_table>
                <db_key_field>id</db_key_field>
                <db_final_class_field />
                <naming>
                    <attributes>
                        <attribute id="order_request_line_item_id" />
                        <attribute id="functionalci_id" />
                    </attributes>
                </naming>
                <uniqueness_rules>
                    <rule id="unique_item_ci">
                        <attributes>
                            <attribute id="order_request_line_item_id" />
                            <attribute id="functionalci_id" />
                        </attributes>
                        <is_blocking>true</is_blocking>
                    </rule>
                </uniqueness_rules>
                <is_link>1</is_link>
            </properties>
            <fields>
                <field id="order_request_line_item_id" xsi:type="AttributeExternalKey">
                    <sql>order_request_line_item_id</sql>
                    <target_class>OrderRequestLineItem</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="order_request_line_item_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>order_request_line_item_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <!-- Optional hilfreich: direkte Anzeige der OR-Referenz -->
                <field id="order_request_ref" xsi:type="AttributeExternalField">
                    <extkey_attcode>order_request_line_item_id</extkey_attcode>
                    <target_attcode>order_request_ref</target_attcode>
                </field>
                <field id="functionalci_id" xsi:type="AttributeExternalKey">
                    <sql>functionalci_id</sql>
                    <target_class>FunctionalCI</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="functionalci_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>functionalci_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
            </fields>
            <methods />
            <presentation>
                <details>
                    <items>
                        <item id="order_request_ref" />
                        <item id="order_request_line_item_name" />
                        <item id="functionalci_id" />
                    </items>
                </details>
                <list>
                    <items>
                        <item id="order_request_ref" />
                        <item id="order_request_line_item_name" />
                        <item id="functionalci_name" />
                    </items>
                </list>
                <search>
                    <items>
                        <item id="order_request_ref" />
                        <item id="order_request_line_item_name" />
                        <item id="functionalci_name" />
                    </items>
                </search>
            </presentation>
        </class>


        <!-- ***************** Typology ***************** -->
        <class id="OrderRequestType" _delta="define">
            <parent>cmdbAbstractObject</parent>
            <php_parent>
                <name>BR\Extension\OrderRequest\Model\_OrderRequestType</name>
                <file>src/Model/_OrderRequestType.php</file>
            </php_parent>
            <properties>
                <category>bizmodel,searchable,application</category>
                <abstract>false</abstract>
                <key_type>autoincrement</key_type>
                <db_table>orderrequesttype</db_table>
                <db_key_field>id</db_key_field>
                <db_final_class_field />
                <naming>
                    <attributes>
                        <attribute id="name" />
                    </attributes>
                </naming>
                <uniqueness_rules>
                    <rule id="unique_code">
                        <attributes>
                            <attribute id="org_id" />
                            <attribute id="code" />
                        </attributes>
                        <is_blocking>true</is_blocking>
                    </rule>
                </uniqueness_rules>
                <fields_semantic>
                    <state_attribute>status</state_attribute>
                </fields_semantic>
                <style>
                    <icon>images/orderrequesttype.svg</icon>
                    <main_color>#12B8A9</main_color>
                </style>
                <reconciliation>
                    <attributes>
                        <attribute id="code" />
                        <attribute id="name" />
                        <attribute id="org_id" />
                        <attribute id="org_name" />
                    </attributes>
                </reconciliation>
            </properties>
            <fields>
                <field id="org_id" xsi:type="AttributeExternalKey">
                    <sql>org_id</sql>
                    <target_class>Organization</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_AUTO</on_target_delete>
                </field>
                <field id="org_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>org_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <field id="name" xsi:type="AttributeString">
                    <sql>name</sql>
                    <is_null_allowed>false</is_null_allowed>
                </field>
                <field id="code" xsi:type="AttributeString">
                    <sql>code</sql>
                    <is_null_allowed>false</is_null_allowed>
                </field>
                <field id="description" xsi:type="AttributeHTML">
                    <sql>description</sql>
                    <default_value />
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="default_approver_id" xsi:type="AttributeExternalKey">
                    <sql>default_approver_id</sql>
                    <target_class>Person</target_class>
                    <filter>
                        <![CDATA[SELECT Person AS P JOIN Organization AS Node ON P.org_id = Node.id JOIN Organization AS Root ON Node.parent_id BELOW Root.id WHERE Root.id = :this->org_id]]>
                    </filter>
                    <dependencies>
                        <attribute id="org_id" />
                    </dependencies>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="default_approver_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>default_approver_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <field id="status" xsi:type="AttributeEnum">
                    <sql>status</sql>
                    <is_null_allowed>false</is_null_allowed>
                    <default_value>active</default_value>
                    <values>
                        <value id="active">
                            <code>active</code>
                            <rank>10</rank>
                            <style>
                                <main_color>$ibo-lifecycle-active-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-active-state-secondary-color</complementary_color>
                                <decoration_classes />
                            </style>
                        </value>
                        <value id="inactive">
                            <code>inactive</code>
                            <rank>20</rank>
                            <style>
                                <main_color>$ibo-lifecycle-inactive-state-primary-color</main_color>
                                <complementary_color>$ibo-lifecycle-inactive-state-secondary-color</complementary_color>
                                <decoration_classes />
                            </style>
                        </value>
                    </values>
                    <sort_type>rank</sort_type>
                    <display_style>list</display_style>
                </field>
                <field id="requires_budget_owner_approval" xsi:type="AttributeBoolean">
                    <sql>requires_budget_owner_approval</sql>
                    <is_null_allowed>false</is_null_allowed>
                    <default_value>no</default_value>
                </field>
                <field id="budget_approver_id" xsi:type="AttributeExternalKey">
                    <sql>budget_approver_id</sql>
                    <target_class>Person</target_class>
                    <filter>
                        <![CDATA[SELECT Person AS P JOIN Organization AS Node ON P.org_id = Node.id JOIN Organization AS Root ON Node.parent_id BELOW Root.id WHERE Root.id = :this->org_id]]>
                    </filter>
                    <dependencies>
                        <attribute id="org_id" />
                        <attribute id="requires_budget_owner_approval" />
                    </dependencies>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                </field>
                <field id="budget_approver_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>budget_approver_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
            </fields>
            <event_listeners>
                <event_listener id="OnOrderRequestTypeSetAttributesFlags">
                    <event>EVENT_DB_SET_ATTRIBUTES_FLAGS</event>
                    <callback>OnOrderRequestTypeSetAttributesFlags</callback>
                    <rank>10</rank>
                </event_listener>
                <event_listener id="OnOrderRequestTypeCheckToWrite">
                    <event>EVENT_DB_CHECK_TO_WRITE</event>
                    <callback>OnOrderRequestTypeCheckToWrite</callback>
                    <rank>10</rank>
                </event_listener>
            </event_listeners>
            <methods />
            <presentation>
                <details>
                    <items>
                        <item id="name">
                            <rank>10</rank>
                        </item>
                        <item id="org_id">
                            <rank>20</rank>
                        </item>
                        <item id="code">
                            <rank>30</rank>
                        </item>
                        <item id="status">
                            <rank>40</rank>
                        </item>
                        <item id="default_approver_id">
                            <rank>50</rank>
                        </item>
                        <item id="requires_budget_owner_approval">
                            <rank>60</rank>
                        </item>
                        <item id="budget_approver_id">
                            <rank>70</rank>
                        </item>
                        <item id="description">
                            <rank>80</rank>
                        </item>
                    </items>
                </details>
                <search>
                    <items>
                        <item id="name">
                            <rank>10</rank>
                        </item>
                        <item id="code">
                            <rank>20</rank>
                        </item>
                        <item id="org_id">
                            <rank>30</rank>
                        </item>
                        <item id="status">
                            <rank>40</rank>
                        </item>
                        <item id="default_approver_id">
                            <rank>50</rank>
                        </item>
                        <item id="requires_budget_owner_approval">
                            <rank>60</rank>
                        </item>
                        <item id="budget_approver_id">
                            <rank>70</rank>
                        </item>
                        <item id="description">
                            <rank>80</rank>
                        </item>
                    </items>
                </search>
                <list>
                    <items>
                        <item id="org_id">
                            <rank>20</rank>
                        </item>
                        <item id="status">
                            <rank>30</rank>
                        </item>
                        <item id="code">
                            <rank>40</rank>
                        </item>
                        <item id="default_approver_id">
                            <rank>50</rank>
                        </item>
                        <item id="requires_budget_owner_approval">
                            <rank>60</rank>
                        </item>
                        <item id="budget_approver_id">
                            <rank>70</rank>
                        </item>
                    </items>
                </list>
                <summary>
                    <items>
                        <item id="code">
                            <rank>10</rank>
                        </item>
                        <item id="org_id">
                            <rank>20</rank>
                        </item>
                        <item id="default_approver_id">
                            <rank>30</rank>
                        </item>
                    </items>
                </summary>
            </presentation>
        </class>
    </classes>
    <!-- ***************** Menus ***************** -->
    <menus>
        <menu id="OrderRequest" xsi:type="MenuGroup" _delta="define">
            <rank>60</rank>
            <style>
                <decoration_classes>fas fa-shopping-cart</decoration_classes>
            </style>
            <enable_class>OrderRequestType</enable_class>
            <enable_admin_only>0</enable_admin_only>
        </menu>
        <menu id="OrderRequestSpace" xsi:type="DashboardMenuNode" _delta="define">
            <rank>0</rank>
            <parent>OrderRequest</parent>
            <enable_class>OrderRequestType</enable_class>
            <enable_action>UR_ACTION_READ</enable_action>
            <definition>
                <layout>DashboardLayoutOneCol</layout>
                <title />
                <cells>
                    <cell id="banf-100">
                        <rank>1</rank>
                        <dashlets>
                            <dashlet id="banf-101" xsi:type="DashletHeaderStatic">
                                <rank>101</rank>
                                <title>Menu:OrderRequestSpace:Header</title>
                            </dashlet>
                            <dashlet id="banf-110" xsi:type="DashletBadge">
                                <rank>110</rank>
                                <class>OrderRequest</class>
                            </dashlet>
                            <dashlet id="banf-120" xsi:type="DashletBadge">
                                <rank>120</rank>
                                <class>OrderRequestType</class>
                            </dashlet>
                        </dashlets>
                    </cell>
                </cells>
            </definition>
        </menu>
    </menus>
    <module_parameters>
        <parameters id="br-orderrequest" _delta="define">
            <!-- policy_mode: off, warn, enforce -->
            <policy_mode type="string">warn</policy_mode>
            <!-- approval_restrict_to_assigned_approver -->
            <approval_restrict_to_assigned_approver type="bool">true</approval_restrict_to_assigned_approver>
            <!-- approval_forbid_self_approval -->
            <approval_forbid_self_approval type="bool">true</approval_forbid_self_approval>
            <!-- budget_auto_threshold: 0 = off -->
            <budget_auto_threshold type="int">0</budget_auto_threshold>
        </parameters>
    </module_parameters>
</itop_design>
